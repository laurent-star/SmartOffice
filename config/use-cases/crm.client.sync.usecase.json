{
  "id": "crm.client.sync",
  "version": "1.0.0",
  "description": "Cree ou met a jour les donnees client dans Monday et Axonaut, puis envoie un email.",
  "inputs": [
    "context.monday.board_id",
    "memory.state.client",
    "memory.state.client.company",
    "memory.state.client.contact.email",
    "memory.state.client.contact.name"
  ],
  "outputs": [
    "memory.state.client.monday_item_id",
    "memory.state.client.axonaut_company_id"
  ],
  "steps": [
    {
      "id": "monday_upsert",
      "type": "tool",
      "ref": "monday",
      "params": {
        "action": "boardItem.create",
        "boardId": "{{context.monday.board_id}}",
        "itemName": "{{memory.state.client.contact.name}}"
      },
      "save": {
        "to": {
          "memory.state.client.monday_item_id": "$.data.itemId"
        }
      }
    },
    {
      "id": "axonaut_update",
      "type": "tool",
      "ref": "axonaut",
      "params": {
        "action": "company.update",
        "company_id": "{{memory.state.client.company.id}}",
        "fields": "{{memory.state.client.company}}"
      },
      "save": {
        "to": {
          "memory.state.client.axonaut_company_id": "$.data.company_id"
        }
      }
    },
    {
      "id": "welcome_email",
      "type": "tool",
      "ref": "brevo",
      "params": {
        "action": "email.sendEmail",
        "to": "{{memory.state.client.contact.email}}",
        "subject": "Bienvenue {{memory.state.client.contact.name}}",
        "body": "Votre dossier est cree. Reference: {{memory.state.client.monday_item_id}}"
      }
    }
  ]
}
