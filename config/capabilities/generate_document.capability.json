{
  "id": "generate_document",
  "version": "1.0.0",
  "description": "Génère un document à partir d'un modèle et expose ses métadonnées.",
  "inputs": [
    "memory.state.document.brief",
    "memory.state.document.schema",
    "context.docs.template_id",
    "context.docs.folder_id"
  ],
  "outputs": [
    "memory.state.document.payload",
    "memory.state.document.id",
    "memory.state.document.file"
  ],
  "steps": [
    {
      "id": "draft_content",
      "type": "tool",
      "ref": "openai",
      "params": {
        "action": "text.generateModelResponse",
        "text": "{{memory.state.document.brief}}",
        "schema": "{{memory.state.document.schema}}"
      },
      "save": {
        "to": {
          "memory.state.document.payload": "$.data.structured_data"
        }
      }
    },
    {
      "id": "create_document",
      "type": "tool",
      "ref": "google-docs",
      "params": {
        "action": "document.create",
        "title": "Document {{context.docs.template_id}}",
        "folderId": "{{context.docs.folder_id}}"
      },
      "save": {
        "to": {
          "memory.state.document.id": "$.data.documentId"
        }
      }
    },
    {
      "id": "update_document",
      "type": "tool",
      "ref": "google-docs",
      "params": {
        "action": "document.update",
        "documentId": "{{memory.state.document.id}}",
        "text": "{{memory.state.document.payload}}"
      }
    },
    {
      "id": "fetch_document",
      "type": "tool",
      "ref": "google-drive",
      "params": {
        "action": "file.download",
        "fileId": "{{memory.state.document.id}}"
      },
      "save": {
        "to": {
          "memory.state.document.file": "$.data.file"
        }
      }
    }
  ]
}
