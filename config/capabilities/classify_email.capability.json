{
  "id": "classify_email",
  "version": "1.0.0",
  "description": "Analyse un email entrant et catégorise la demande avant routage.",
  "inputs": [
    "memory.state.email.body",
    "memory.state.email.from",
    "memory.state.email.subject",
    "memory.state.email.attachment",
    "context.slack.incident_channel",
    "context.drive.archive_folder"
  ],
  "outputs": [
    "memory.state.email.category"
  ],
  "steps": [
    {
      "id": "classify",
      "type": "tool",
      "ref": "openai",
      "params": {
        "action": "assistant.classify",
        "text": "{{memory.state.email.body}}",
        "labels": ["incident", "demande", "information"]
      },
      "save": {
        "to": {
          "memory.state.email.category": "$.data.classification"
        }
      }
    },
    {
      "id": "notify_incident",
      "type": "tool",
      "ref": "slack",
      "when": { "path": "memory.state.email.category", "eq": "incident" },
      "params": {
        "action": "message.send",
        "channel": "{{context.slack.incident_channel}}",
        "text": "Incident détecté pour {{memory.state.email.from}} : {{memory.state.email.subject}}"
      }
    },
    {
      "id": "archive_information",
      "type": "tool",
      "ref": "google-drive",
      "when": { "path": "memory.state.email.category", "eq": "information" },
      "params": {
        "action": "file.upload",
        "name": "{{memory.state.email.attachment.name}}",
        "folderId": "{{context.drive.archive_folder}}",
        "binary": "{{memory.state.email.attachment.binary}}"
      }
    }
  ]
}
